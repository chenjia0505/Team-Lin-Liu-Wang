---
title: "Will the 100% clean energy commitment be on time?"
author: "Zhenghao Lin, Chenjia Liu, Shuyi Wang"
output: pdf_document
date: "Fall 2023"
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r include = FALSE}
knitr::opts_chunk$set(echo=FALSE)
```

```{r setup, include=FALSE}

# Set your working directory
library(here)
here()

# Load your packages
library(rlist)
library(tidyverse)
library(dplyr)
library(lubridate)
library(here)
library(trend)
library(tseries)
library(forecast)
# Set your working directory
here()
# Set your ggplot theme
mytheme <- theme_bw()+
  theme(plot.title = element_text(hjust=0.5),
  plot.subtitle =element_text(hjust=0.5),
  text=element_text(size=12, family='sans'),
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank())
# Load your datasets
# Import data set and drop first 4 rows
Michigan_raw<- read.csv(file=here("Data/Michigan_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Minnesota_raw<- read.csv(file=here("Data/Minnesota_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Nevada_raw<- read.csv(file=here("Data/Nevada_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
New_Mexico_raw<- read.csv(file=here("Data/New_Mexico_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
California_raw<- read.csv(file=here("Data/California_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Connecticut_raw<- read.csv(file=here("Data/Connecticut_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Illinois_raw<- read.csv(file=here("Data/Illinois_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Maine_raw<- read.csv(file=here("Data/Maine_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
New_York_raw<- read.csv(file=here("Data/New_York_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Oregon_raw<- read.csv(file=here("Data/Oregon_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Virginia_raw<- read.csv(file=here("Data/Virginia_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Washington_raw<- read.csv(file=here("Data/Washington_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
# Remove the first 4 rows with no useful information
# Transpose the dataframe
# Convert to a data frame and set column names
# Drop the first 3 rows and repeated columns
# Generate sequence of dates starting from January 2001
# Add a 'State' column indicating 'Michigan'
# Rename columns for clarity
Michigan <- Michigan_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Michigan")

Minnesota <- Minnesota_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Minnesota")

Nevada <- Nevada_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Nevada")

New_Mexico <- New_Mexico_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "New_Mexico")

California <- California_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "California")

Connecticut <- Connecticut_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Connecticut")

Illinois <- Illinois_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Illinois")

Maine <- Maine_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Maine")

New_York <- New_York_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "New_York")

Oregon <- Oregon_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Oregon")

Virginia <- Virginia_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Virginia")

Washington <- Washington_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Washington")
#build a function to change the name of columns
set_column_names <- function(data) {
  names(data) <- c(
    "All fuels",
    "coal",
    "petroleum liquids",
    "petroleum coke",
    "natural gas",
    "other gases",
    "nuclear",
    "conventional hydroelectric",
    "other renewables",
    "other renewables:wind",
    "other renewables:geothermal",
    "other renewables:biomass",
    "biomass:wood and wood-derived fuels",
    "biomass:other biomass",
    "hydro-electric pumped storage",
    "other",
    "all solar",
    "small-scale solar photovoltaic",
    "all utility-scale solar",
    "all utility-scale solar:utility-scale photovoltaic",
    "all utility-scale solar:utility-scale thermal",
    "Date",
    "State"
  )
  rownames(data) <- seq_len(nrow(data))
  return(data)
}
#Rename columns
Michigan <- set_column_names(Michigan)
Minnesota <- set_column_names(Minnesota)
Nevada <- set_column_names(Nevada)
New_Mexico <- set_column_names(New_Mexico)
California <- set_column_names(California)
Connecticut <- set_column_names(Connecticut)
Illinois <- set_column_names(Illinois)
Maine <- set_column_names(Maine)
New_York <- set_column_names(New_York)
Oregon <- set_column_names(Oregon)
Virginia <- set_column_names(Virginia)
Washington <- set_column_names(Washington)
#Build a function to convert columns to numeric
convert_columns_to_numeric <- function(data) {
  columns_to_convert <- 1:(ncol(data) - 2)
  data[, columns_to_convert] <- apply(data[, columns_to_convert], 2, as.numeric)
  return(data)
}
#Convert to numeric
Michigan <- convert_columns_to_numeric(Michigan)
Minnesota <- convert_columns_to_numeric(Minnesota)
Nevada <- convert_columns_to_numeric(Nevada)
New_Mexico <- convert_columns_to_numeric(New_Mexico)
California <- convert_columns_to_numeric(California)
Connecticut <- convert_columns_to_numeric(Connecticut)
Illinois <- convert_columns_to_numeric(Illinois)
Maine <- convert_columns_to_numeric(Maine)
New_York <- convert_columns_to_numeric(New_York)
Oregon <- convert_columns_to_numeric(Oregon)
Virginia <- convert_columns_to_numeric(Virginia)
Washington <- convert_columns_to_numeric(Washington)
#Generate a dataframe with all states
combined_df <- rbind(Michigan, Minnesota, Nevada, New_Mexico, California, Connecticut,  Illinois, Maine,New_York, Oregon, Virginia, Washington)
```

# Rationale and Research Questions
## Introduction
In addition to the”Renewable Energy Portfolios” (RPS) that requires certain percentages of energy to be generated from renewable energy sources, many states have enacted “Clean Energy Standards” (CES) that separates clean energy sources that are carbon-free or carbon-neutral from renewable sources which may generate carbon emissions (2021). Under CES, clean energy sources include nuclear, hydropower, solar power, wind, and other renewables. Most CES would include RPS as a part of the policy. 

Currently, there are 12 states that have established 100% Clean energy goals though their times vary. In this analysis, we are interested in whether those states are able able to meet their clean energy commitments by the planned years under current development. The objective is to understand the clean energy development trends in different states in the past and the future, and which states should accelerate their clean energy transitions more rapidly than others. Therefore, the electricity generation data for each of the 12 states from EIA are chosen for the quantitative analysis. Our research questions revolves around the comparison between the growth of clean energy generation versus the growth of total energy generation in the 12 states. 

## Research Questions
1. What would the trend of clean energy generation be until the commitment years for each of the 12 states? 
2. What would the trend of total energy generation be until the commitment years for each of the 12 states?
3. How does the clean energy generation growth compare to the total energy generation growth? (Does clean eenrgy generation meet total energy generation?)

\newpage

# Dataset Information
All datasets used in this analysis were obtained from the U.S. Energy Information Administration (EIA) website, utilizing the ELECTRICITY DATA BROWSER. The data comprises monthly net electricity generation across twelve states committed to achieving 100% carbon-free electricity in the near future. Specifically, it includes net generation figures for coal, petroleum liquids, petroleum coke, natural gas, other gases, nuclear, conventional hydroelectric, wind, geothermal, biomass, wood and wood-derived fuels, hydro-electric pumped storage, small-scale solar photovoltaic, utility-scale photovoltaic, and utility-scale thermal sources from January 2001 to August 2023.

# Dataset Wrangling 
The datasets for each state are downloaded and processed separately. Upon importing the data into R, a function is developed to eliminate extraneous information. The initial four descriptive rows, which don't contribute to the analysis, are removed. The raw data organizes dates in columns and net generation by sectors in rows. To facilitate analysis, the dataset is transposed. This transposed data is converted into a data frame, ensuring that columns remain as intended and are not converted into factors. Column names are set based on the first row of transposed data.

Following this, rows 2 to 4 (containing unnecessary information) are removed. Additionally, columns 11 to 13, representing 'All-utility scale solar' under the subset of other renewable sectors, are excluded. This step is necessary to prevent double counting since there's an independent sector for all solar.

A new 'Date' column is created, starting from January 1, 2001, incremented by one month, and ending based on the dataset's row count. Simultaneously, a 'State' column is added, assigning the respective state name to each row. Column names are then refined for better clarity using a dedicated function.

Furthermore, a function is designed to convert all columns, excluding the last two (date and state), to a numeric format. Finally, a new data frame encompassing data from the 12 states is generated by merging the individual datasets based on the state name. The following table presents the processed data structure.

```{r}
EIA_data_summary<-data.frame(
  Column_name=c("All fuels",
    "coal",
    "petroleum liquids",
    "petroleum coke",
    "natural gas",
    "other gases",
    "nuclear",
    "conventional hydroelectric",
    "other renewables",
    "other renewables:wind",
    "other renewables:geothermal",
    "other renewables:biomass",
    "biomass:wood and wood-derived fuels",
    "biomass:other biomass",
    "hydro-electric pumped storage",
    "other",
    "all solar",
    "small-scale solar photovoltaic",
    "all utility-scale solar",
    "all utility-scale solar:utility-scale photovoltaic",
    "all utility-scale solar:utility-scale thermal",
    "Date",
    "State"),
  Unit=c("thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "day-montth-year",
         "Michigan, Minnesota, Nevada, New_Mexico, California, Connecticut,  Illinois, Maine, New_York, Oregon, Virginia, Washington")
)
knitr::kable(EIA_data_summary,caption = "Table summarizing the dataset structure")
```


\newpage

# Exploratory Analysis 
```{r funtioncs}
csvs <- list.files(path = here('Processed'),pattern = "\\.csv$", full.names = TRUE)

file_name <- c('California','combined_df', 'Connecticut', 
               'Illinois', 'Maine', 'Michigan', 'Minnesota', 
               'Nevada', 'New_Mexico', 'New_York', 
               'Oregon', 'Virginia', 'Washington')

names(csvs) <- file_name

#create a function that read csv files
csv_reader <- function(state_name) {
  file_i <- read.csv(csvs[[state_name]], stringsAsFactors = TRUE)
}

# create a function that wrangles data, add a column for total energy generations
data_all <- function(state_name){
  state_data <- csv_reader(state_name) %>% 
    mutate(Date = ymd(Date)) %>% 
    replace(is.na(.),0) %>%
    select(All.fuels, Date)
}

data_clean <- function(state_name){
  state_data <- csv_reader(state_name) %>% 
    mutate(Date = ymd(Date)) %>% 
    replace(is.na(.),0) %>% 
    mutate(clean_energy = nuclear+
          conventional.hydroelectric+
          other.renewables+
          hydro.electric.pumped.storage+
          other) %>%
    select(clean_energy, Date)
  }

# Create a function that plots energy generation percentages  
plot_clean <- function(state_name){ggplot(data_clean(state_name), 
                                            aes(x=Date, y=clean_energy))+
    geom_line(color='lightgreen')+
    geom_smooth(method = 'loess', color='brown')+
    scale_x_date(breaks=scales::breaks_pretty(10))+
    scale_y_continuous(breaks=scales::breaks_pretty(10))+
    labs(y= 'Clean Energy Generation (MWh)', x='Date', title='Clean Energy Generation (MWh)', subtitle = paste(state_name,'(2001.1-2023.8)'))+
    mytheme
  }
  
  

plot_all <- function(state_name){ggplot(data_all(state_name), 
                                            aes(x=Date, y=All.fuels))+
    geom_line(color='darkslategray3')+
    geom_smooth(method = 'loess', color='coral')+
    scale_x_date(breaks=scales::breaks_pretty(10))+
    scale_y_continuous(breaks=scales::breaks_pretty(10))+
    labs(y= 'All Fuels', x='Date', title='All Fuels', subtitle = paste(state_name,'(2001.1-2023.8)'))+
    mytheme
}
```

```{r, EA CA}
california <- csv_reader('California')

#CA clean energy
CA.clean <- data_clean('California')
#CA.clean graph
plot_clean('California')
#CA.clean TS
CA.clean.ts <- ts(CA.clean$clean_energy, start = c(2001,1),frequency = 12)
decompose.clean <- decompose(CA.clean.ts)
plot(decompose.clean)
adf.test(CA.clean.ts, alternative="stationary", k=0)


#CA.all
CA.all <-data_all('California')
#CA.all graph
plot_all("California")
#CA.all TS
CA.all.ts <- ts(CA.all$All.fuels, start = c(2001,1),frequency = 12)
decompose <- decompose(CA.all.ts)
plot(decompose)
adf.test(CA.all.ts, alternative="stationary", k=0)
```

```{r}
connecticut <- csv_reader('Connecticut')

# CT clean energy
CT.clean <- data_clean('Connecticut')
# CT clean graph
plot_clean('Connecticut')
# CT clean TS
CT.clean.ts <- ts(CT.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(CT.clean.ts)
plot(decompose.clean)
adf.test(CT.clean.ts, alternative = "stationary", k = 0)

# CT all
CT.all <- data_all('Connecticut')
# CT all graph
plot_all("Connecticut")
# CT all TS
CT.all.ts <- ts(CT.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(CT.all.ts)
plot(decompose)
adf.test(CT.all.ts, alternative = "stationary", k = 0)
```

```{r}
illinois <- csv_reader('Illinois')

# IL clean energy
IL.clean <- data_clean('Illinois')
# IL clean graph
plot_clean('Illinois')
# IL clean TS
IL.clean.ts <- ts(IL.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(IL.clean.ts)
plot(decompose.clean)
adf.test(IL.clean.ts, alternative = "stationary", k = 0)

# IL all
IL.all <- data_all('Illinois')
# IL all graph
plot_all("Illinois")
# IL all TS
IL.all.ts <- ts(IL.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(IL.all.ts)
plot(decompose)
adf.test(IL.all.ts, alternative = "stationary", k = 0)
```

```{r}
maine <- csv_reader('Maine')

# Maine clean energy
ME.clean <- data_clean('Maine')
# Maine clean graph
plot_clean('Maine')
# Maine clean TS
ME.clean.ts <- ts(ME.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(ME.clean.ts)
plot(decompose.clean)
adf.test(ME.clean.ts, alternative = "stationary", k = 0)

# Maine all
ME.all <- data_all('Maine')
# Maine all graph
plot_all("Maine")
# Maine all TS
ME.all.ts <- ts(ME.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(ME.all.ts)
plot(decompose)
adf.test(ME.all.ts, alternative = "stationary", k = 0)
```

```{r}
michigan <- csv_reader('Michigan')

# MI clean energy
MI.clean <- data_clean('Michigan')
# MI clean graph
plot_clean('Michigan')
# MI clean TS
MI.clean.ts <- ts(MI.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(MI.clean.ts)
plot(decompose.clean)
adf.test(MI.clean.ts, alternative = "stationary", k = 0)

# MI all
MI.all <- data_all('Michigan')
# MI all graph
plot_all("Michigan")
# MI all TS
MI.all.ts <- ts(MI.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(MI.all.ts)
plot(decompose)
adf.test(MI.all.ts, alternative = "stationary", k = 0)
```
```{r}
minnesota <- csv_reader('Minnesota')

# MN clean energy
MN.clean <- data_clean('Minnesota')
# MN clean graph
plot_clean('Minnesota')
# MN clean TS
MN.clean.ts <- ts(MN.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(MN.clean.ts)
plot(decompose.clean)
adf.test(MN.clean.ts, alternative = "stationary", k = 0)

# MN all
MN.all <- data_all('Minnesota')
# MN all graph
plot_all("Minnesota")
# MN all TS
MN.all.ts <- ts(MN.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(MN.all.ts)
plot(decompose)
adf.test(MN.all.ts, alternative = "stationary", k = 0)
```

```{r}
nevada <- csv_reader('Nevada')

# NV clean energy
NV.clean <- data_clean('Nevada')
# NV clean graph
plot_clean('Nevada')
# NV clean TS
NV.clean.ts <- ts(NV.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(NV.clean.ts)
plot(decompose.clean)
adf.test(NV.clean.ts, alternative = "stationary", k = 0)

# NV all
NV.all <- data_all('Nevada')
# NV all graph
plot_all("Nevada")
# NV all TS
NV.all.ts <- ts(NV.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(NV.all.ts)
plot(decompose)
adf.test(NV.all.ts, alternative = "stationary", k = 0)
```

```{r}
new_mexico <- csv_reader('New_Mexico')

# NM clean energy
NM.clean <- data_clean('New_Mexico')
# NM clean graph
plot_clean('New_Mexico')
# NM clean TS
NM.clean.ts <- ts(NM.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(NM.clean.ts)
plot(decompose.clean)
adf.test(NM.clean.ts, alternative = "stationary", k = 0)

# NM all
NM.all <- data_all('New_Mexico')
# NM all graph
plot_all("New_Mexico")
# NM all TS
NM.all.ts <- ts(NM.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(NM.all.ts)
plot(decompose)
adf.test(NM.all.ts, alternative = "stationary", k = 0)
```

```{r}
new_york <- csv_reader('New_York')

# NY clean energy
NY.clean <- data_clean('New_York')
# NY clean graph
plot_clean('New_York')
# NY clean TS
NY.clean.ts <- ts(NY.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(NY.clean.ts)
plot(decompose.clean)
adf.test(NY.clean.ts, alternative = "stationary", k = 0)

# NY all
NY.all <- data_all('New_York')
# NY all graph
plot_all("New_York")
# NY all TS
NY.all.ts <- ts(NY.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(NY.all.ts)
plot(decompose)
adf.test(NY.all.ts, alternative = "stationary", k = 0)
```

```{r}
oregon <- csv_reader('Oregon')

# OR clean energy
OR.clean <- data_clean('Oregon')
# OR clean graph
plot_clean('Oregon')
# OR clean TS
OR.clean.ts <- ts(OR.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(OR.clean.ts)
plot(decompose.clean)
adf.test(OR.clean.ts, alternative = "stationary", k = 0)

# OR all
OR.all <- data_all('Oregon')
# OR all graph
plot_all("Oregon")
# OR all TS
OR.all.ts <- ts(OR.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(OR.all.ts)
plot(decompose)
adf.test(OR.all.ts, alternative = "stationary", k = 0)
```

```{r}
virginia <- csv_reader('Virginia')

# VA clean energy
VA.clean <- data_clean('Virginia')
# VA clean graph
plot_clean('Virginia')
# VA clean TS
VA.clean.ts <- ts(VA.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(VA.clean.ts)
plot(decompose.clean)
adf.test(VA.clean.ts, alternative = "stationary", k = 0)

# VA all
VA.all <- data_all('Virginia')
# VA all graph
plot_all("Virginia")
# VA all TS
VA.all.ts <- ts(VA.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(VA.all.ts)
plot(decompose)
adf.test(VA.all.ts, alternative = "stationary", k = 0)
```

```{r}
washington <- csv_reader('Washington')

# WA clean energy
WA.clean <- data_clean('Washington')
# WA clean graph
plot_clean('Washington')
# WA clean TS
WA.clean.ts <- ts(WA.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean <- decompose(WA.clean.ts)
plot(decompose.clean)
adf.test(WA.clean.ts, alternative = "stationary", k = 0)

# WA all
WA.all <- data_all('Washington')
# WA all graph
plot_all("Washington")
# WA all TS
WA.all.ts <- ts(WA.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose <- decompose(WA.all.ts)
plot(decompose)
adf.test(WA.all.ts, alternative = "stationary", k = 0)
```

\newpage

# Analysis 
To compare the future trend of clean energy and total energy generation, we choose to use ARIMA model to forecast the future trends. The ARIMA model captures the patterns, seasonality, and trends of the data, which is particularly useful for forecasting future values that are correlated with past values. 
```{r time series, echo=FALSE}
# ts function
statets_clean <- function(state_name){
  state_data <- data_clean(state_name)
  f_month = month(first(state_data$Date))
  f_year = year(first(state_data$Date))
  clean.fuel.ts <- ts(
    state_data$clean_energy,
    start = c(f_year, f_month),
    frequency = 12)
  return(clean.fuel.ts)
}

statets_all <- function(state_name){
  state_data <- data_all(state_name)
  f_month = month(first(state_data$Date))
  f_year = year(first(state_data$Date))
  all.fuel.ts <- ts(
    state_data$All.fuels,
    start = c(f_year, f_month),
    frequency = 12)
  return(all.fuel.ts)
}

# create lists for result dataframe 
State <- c()
Forecasted.Year <- c()
All.Energy.Forecast <- c()
Clean.Energy.Forecast <- c()

#ARIMA forecasting
arima.all <- function(state_name,t){
  all.fuel.arima <- auto.arima(statets_all(state_name))
  all.fuel.forecast <- forecast(all.fuel.arima, level=c(95), h=t*12)
  last_date_forecast = 2023+t 
  plot <- autoplot(all.fuel.forecast)+
    labs(y= 'All Fuel', x='Date', title='All Fuel Forecast', subtitle = paste(state_name, paste('(2001 -',last_date_forecast, ')')))+
    mytheme
  last.forecast <- all.fuel.forecast$mean[length(all.fuel.forecast$mean)]
  State <- list.append(State, state_name)
  State <<- State
  Forecasted.Year <- list.append(Forecasted.Year, last_date_forecast)
  Forecasted.Year <<- Forecasted.Year
  All.Energy.Forecast <- list.append(All.Energy.Forecast, last.forecast)
  All.Energy.Forecast <<- All.Energy.Forecast
  print(plot)
}

arima.clean <- function(state_name,t){
  clean.arima <- auto.arima(statets_clean(state_name))
  clean.forecast <- forecast(clean.arima, level=c(95), h=t*12)
  plot <- autoplot(clean.forecast)+
    labs(y= 'Clean Energy Generation (MWh)', x='Date', title='Clean Energy Generation Forecast (MWh)', subtitle = paste(state_name,'(2001.1-2023.8)'))+
    mytheme
  last.forecast <- clean.forecast$mean[length(clean.forecast$mean)]
  Clean.Energy.Forecast <- list.append(Clean.Energy.Forecast, last.forecast)
  Clean.Energy.Forecast <<- Clean.Energy.Forecast
  print(plot)
}
```

## Question 1: What would the trend of clean energy generation be until the commitment years for each of the 12 states? 
The following line charts depicts the forecast trend of clean energy generation until each state's commitment year: 

### California 
```{r Clean Forecast California, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('California', 23)
```
### Connecticut 
```{r Clean Forecast Connecticut, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('Connecticut', 17)
```
### Illinois 
```{r Clean Forecast Illinois, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('Illinois', 27)
```
### Maine 
```{r Clean Forecast Maine, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('Maine', 27)
```
### Michigan 
```{r Clean Forecast Michigan, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Michigan',17)
```
### Minnesota
```{r Clean Forecast Minnesota, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Minnesota',17)
```
### Nevada
```{r Clean Forecast Nevada, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Nevada',27)
```
### New Mexico
```{r Clean Forecast New Mexico, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('New_Mexico',22)
```
### New York 
```{r Clean Forecast New York, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('New_York',17)
```
### Oregon
```{r Clean Forecast Oregon, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Oregon',17)
```
### Virginia
```{r Clean Forecast Virginia, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Virginia',27)
```
### Washington
```{r Clean Forecast Washington, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Washington',22)
```

## Question 2: What would the trend of total energy generation be until the commitment years for each of the 12 states?
The following line charts depicts the forecast trend of total energy generation until each state's commitment year: 
### California 
```{r All Forecast California, echo=FALSE, fig.align='center', fig.width=14}
arima.all('California', 23)
```
### Connecticut 
```{r All Forecast Connecticut, echo=FALSE, fig.align='center', fig.width=14}
arima.all('Connecticut', 17)
```
### Illinois 
```{r All Forecast Illinois, echo=FALSE, fig.align='center', fig.width=14}
arima.all('Illinois', 27)
```
### Maine 
```{r All Forecast Maine, echo=FALSE, fig.align='center', fig.width=14}
arima.all('Maine', 27)
```
### Michigan 
```{r All Forecast Michigan, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Michigan',17)
```
### Minnesota
```{r All Forecast Minnesota, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Minnesota',17)
```
### Nevada
```{r All Forecast Nevada, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Nevada',27)
```
### New Mexico
```{r All Forecast New Mexico, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('New_Mexico',22)
```
### New York 
```{r All Forecast New York, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('New_York',17)
```
### Oregon
```{r All Forecast Oregon, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Oregon',17)
```
### Virginia
```{r All Forecast Virginia, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Virginia',27)
```
### Washington
```{r All Forecast Washington, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Washington',22)
```

## Question 3: How does the clean energy generation growth compare to the total energy generation growth? (Does clean energy generation meet total energy generation?)
```{r Result, echo=FALSE}
#display result table 
result.df <- data.frame(State=State, 
                        Forecasted.Year=Forecasted.Year, 
                        Clean.Energy.Forecast=Clean.Energy.Forecast, 
                        All.Energy.Forecast=All.Energy.Forecast)

knitr::kable(result.df)
```

\newpage

# Summary and Conclusions
Out of the 12 states that have committed to 100% clean energy goals, only Maine is projected to be able to meet the goal. All other states will likely to fail to meet their commitments, though Illinois is close to meet the goal. 

\newpage

# References
Brief state renewable portfolio standards and goals. National Conference of State Legislatures. (2021, August 31). https://www.ncsl.org/energy/state-renewable-portfolio-standards-and-goals 
<add references here if relevant, otherwise delete this section> 